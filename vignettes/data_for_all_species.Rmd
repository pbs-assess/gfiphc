---
title: "Analyses for all gfsynopsis species"
author: "Andrew Edwards"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analyses for all gfsynopsis species}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 10,
  fig.height = 8
)
```

This vignette extracts, analyses, saves and plots the data for all (>100) species for the
gfsynopsis reports. It only works for users with access to the GFBio database at
the Pacific Biological Station.

```{r setup, message = FALSE, results = FALSE}
library(gfiphc)
```

## Data for all species for gfsynopsis reports

Define common species name:
```{r species}
sp_vec <- gfsynopsis::get_spp_names() %>%
  dplyr::arrange(species_code) %>%
  dplyr::pull(species_common_name)
```

Extract the data, create the four time Series A, B, C and D, compare them, and
plot the results, for all species (will take some time). Series AB (bottom right
panel), if shown, will be the longest time series that can be calculated and
will be representative of the full coast (TODO: check - if others are longest it
may not say that). If it is empty
then one of the other time series is the longest. For rarer species with low
catch rates, it may make more sense to consider Series B.

Change the options to use the cached data and cached results (for example, set
both to `FALSE` when first running):
```{r extract, warning = FALSE, results = FALSE}
for(sp in sp_vec){      # increment these to test, done up to number shown
  iphc_get_calc_plot_full(sp,
                          cached_data = TRUE,    # TRUE if data already saved
                          cached_results = TRUE, # TRUE if results already saved
                          print_sp_name = FALSE,
                          path_data = "all-species-data",
                          path_results = "all-species-results")
}

```

```{r investigating}
# For investigating and checking:
# If results saved:
# series_ABCD_full <- readRDS(paste0("all-species-results/", sp_hyphenate(sp, results = TRUE)))$series_ABCD_full
#
# Else load data and do calculations:
# sp_set_counts <- readRDS(paste0("all-species-data", "/", sp_hyphenate(sp)))
# series_ABCD_full <- calc_iphc_full_res(sp_set_counts$set_counts)
#
# which(sp_vec == sp)
```
